*> PROGRAM-ID: P2.cob
*> AUTHOR: CHRISTOPHER LINTON
*> TEAM: BLUE GROUP
*> TEAM MEMBERS: EVAN COCKERHAM, SUBAL SAPKOTA, JOSEPH SCHENCK
*> DUE DATE: 9-4-2018

IDENTIFICATION DIVISION.
PROGRAM-ID. P2.

ENVIRONMENT DIVISION.
INPUT-OUTPUT SECTION.
FILE-CONTROL.
    SELECT IN-FILE ASSIGN TO "P2In.dat"
        ORGANIZATION IS LINE SEQUENTIAL.
    SELECT OUT-FILE ASSIGN TO "P2Out.dat"
        ORGANIZATION IS LINE SEQUENTIAL.

DATA DIVISION.
FILE SECTION.
FD IN-FILE.
01 IN-RECORD.
    05 STUDENT-NAME          PIC A(19).
    05 STUDENT-NUMBER        PIC X(10).
    05 SEMESTER              PIC X(15).
    05 COURSE                PIC X(15).
    05 COURSE-TITLE          PIC X(30).
    05 GRADE                 PIC A(5).
    05 CREDIT                PIC 9.99.
FD OUT-FILE.
01 OUT-SCHOOL-NAME.
    05 FILLER                PIC A(22).
    05 FILLER                PIC A(34).
01 OUT-SCHOOL-ADDR.
    05 FILLER                PIC A(30).
    05 FILLER                PIC X(18).
01 OUT-SPACE                 PIC A.
01 OUT-STUDENT-NAME          PIC A(19).
01 OUT-STUDENT-NUMBER        PIC X(10).
01 OUT-SEMESTER              PIC X(15).
01 OUT-LABELS.
    05 FILLER                PIC X(15).
    05 FILLER                PIC X(30).
    05 FILLER                PIC A(5).
    05 FILLER                PIC A(11).
    05 FILLER                PIC AAAA.
01 OUT-RECORD.
    05 OUT-COURSE            PIC X(15).
    05 OUT-COURSE-TITLE      PIC X(30).
    05 OUT-GRADE             PIC A(5).
    05 OUT-CREDIT            PIC 9.99.
    05 FILLER                PIC A(5).
    05 OUT-QPTS              PIC ZZ9.99.
01 OUT-EOS-SEMESTER-TOTALS.
    05 FILLER                PIC A(29).
    05 FILLER                PIC A(19).
    05 OUT-SEMESTER-CREDIT   PIC ZZ9.99.
    05 FILLER                PIC A(5).
    05 OUT-SEMESTER-QPTS     PIC ZZ9.99.
    05 FILLER                PIC AAAA.
    05 OUT-SEMESTER-GPA      PIC ZZ9.99.
01 OUT-EOS-CUM-TOTALS.
    05 FILLER                PIC A(29).
    05 FILLER                PIC A(19).
    05 OUT-CUMULATIVE-CREDIT PIC ZZ9.99.
    05 FILLER                PIC A(5).
    05 OUT-CUMULATIVE-QPTS   PIC ZZ9.99.
    05 FILLER                PIC AAAA.
    05 OUT-CUMULATIVE-GPA    PIC ZZ9.99.

WORKING-STORAGE SECTION.
01 WS-SCHOOL-NAME.
    05 FILLER                PIC A(22)   VALUE SPACE.
    05 FILLER                PIC A(34)   VALUE "SOUTHEASTERN LOUISIANA UNIVSERITY".
01 WS-SCHOOL-ADDR.
    05 FILLER                PIC A(30)   VALUE SPACE.
    05 FILLER                PIC X(80)   VALUE "HAMMOND, LA 70402".
01 WS-SPACE                  PIC A       VALUE SPACE.
01 WS-LABELS.
    05 FILLER                PIC X(15)   VALUE "COURSE".
    05 FILLER                PIC X(30)   VALUE "TITLE".
    05 FILLER                PIC A(5)    VALUE "GR".
    05 FILLER                PIC A(11)   VALUE "EARNED".
    05 FILLER                PIC AAAA    VALUE "QPTS".
01 EOF                       PIC A       VALUE "N".
01 WS-SEMESTER               PIC X(15).
01 WS-RECORD.
    05 WS-COURSE             PIC X(15).
    05 WS-COURSE-TITLE       PIC X(30).
    05 WS-GRADE              PIC A(5).
    05 WS-CREDIT             PIC 9.99.
    05 FILLER                PIC A(5)    VALUE SPACE.
    05 WS-QPTS               PIC ZZ9.99.
01 WS-EOS-SEMESTER-TOTALS.
    05 FILLER                PIC A(29)   VALUE SPACE.
    05 FILLER                PIC A(19)   VALUE "SEMESTER".
    05 WS-SEMESTER-CREDIT    PIC ZZ9.99.
    05 FILLER                PIC A(5)    VALUE SPACE.
    05 WS-SEMESTER-QPTS      PIC ZZ9.99.
    05 FILLER                PIC AAAA    VALUE SPACE.
    05 WS-SEMESTER-GPA       PIC ZZ9.99.
01 WS-EOS-CUM-TOTALS.
    05 FILLER                PIC A(29)   VALUE SPACE.
    05 FILLER                PIC A(19)   VALUE "CUMULATIVE".
    05 WS-CUMULATIVE-CREDIT  PIC ZZ9.99.
    05 FILLER                PIC A(5)    VALUE SPACE.
    05 WS-CUMULATIVE-QPTS    PIC ZZ9.99.
    05 FILLER                PIC AAAA    VALUE SPACE.
    05 WS-CUMULATIVE-GPA     PIC ZZ9.99.

*> WSC FIELDS ARE USED FOR COMPUTATION THEN MOVED TO ASSOCIATED WS FIELD.
01 WSC-CREDIT                PIC 999V99  VALUE ZERO.
01 WSC-QPTS                  PIC 999V99  VALUE ZERO.
01 WSC-SEMESTER-CREDIT       PIC 999V99  VALUE ZERO.
01 WSC-CUMULATIVE-CREDIT     PIC 999V99  VALUE ZERO.
01 WSC-SEMESTER-QPTS         PIC 999V99  VALUE ZERO.
01 WSC-CUMULATIVE-QPTS       PIC 999V99  VALUE ZERO.
01 WSC-SEMESTER-GPA          PIC 999V99  VALUE ZERO.
01 WSC-CUMULATIVE-GPA        PIC 999V99  VALUE ZERO.

PROCEDURE DIVISION.
MAIN-LOGIC SECTION.
PROGRAM-BEGIN.

    PERFORM OPENING-PROCEDURE.
    PERFORM WRITE-DISPLAY-REPORT.
    PERFORM CLOSING-PROCEDURE.

PROGRAM-DONE.
    STOP RUN.

OPENING-PROCEDURE.
    OPEN INPUT IN-FILE.
    OPEN OUTPUT OUT-FILE.

CLOSING-PROCEDURE.
    CLOSE IN-FILE, OUT-FILE.

READ-NEXT-RECORD.
    READ IN-FILE NEXT RECORD
        AT END
            MOVE "Y" TO EOF.

WRITE-DISPLAY-REPORT.
    PERFORM READ-NEXT-RECORD.
    MOVE SEMESTER TO WS-SEMESTER.

    PERFORM WRITE-HEADER.
    PERFORM DISPLAY-HEADER.

    PERFORM UNTIL EOF = "Y"
        PERFORM SET-WS-RECORD

        IF EOF = "N" THEN
            IF SEMESTER = WS-SEMESTER THEN
                PERFORM DISPLAY-SEMESTER-RECORDS
                PERFORM WRITE-SEMESTER-RECORDS
                PERFORM UPDATE-SEMESTER-TOTALS
            ELSE
                PERFORM CALCULATE-EOS-TOTALS
                PERFORM DISPLAY-EOS-TOTALS
                PERFORM WRITE-EOS-TOTALS

                MOVE SEMESTER TO WS-SEMESTER

                DISPLAY WS-SPACE
                WRITE OUT-SPACE FROM WS-SPACE
                DISPLAY WS-SEMESTER
                WRITE OUT-SEMESTER FROM WS-SEMESTER

                PERFORM DISPLAY-SEMESTER-RECORDS
                PERFORM WRITE-SEMESTER-RECORDS
                PERFORM UPDATE-SEMESTER-TOTALS
            END-IF
        END-IF

        PERFORM READ-NEXT-RECORD
    END-PERFORM.

    PERFORM CALCULATE-EOS-TOTALS.
    PERFORM DISPLAY-EOS-TOTALS.
    PERFORM WRITE-EOS-TOTALS.

WRITE-HEADER.
    WRITE OUT-SCHOOL-NAME FROM WS-SCHOOL-NAME.
    WRITE OUT-SCHOOL-ADDR FROM WS-SCHOOL-ADDR.
    WRITE OUT-SPACE FROM WS-SPACE.

    WRITE OUT-STUDENT-NAME FROM STUDENT-NAME.
    WRITE OUT-STUDENT-NUMBER FROM STUDENT-NUMBER.
    WRITE OUT-SPACE FROM WS-SPACE.

    WRITE OUT-SEMESTER FROM WS-SEMESTER.
    WRITE OUT-LABELS FROM WS-LABELS.

DISPLAY-HEADER.
    DISPLAY WS-SCHOOL-NAME.
    DISPLAY WS-SCHOOL-ADDR.
    DISPLAY WS-SPACE.

    DISPLAY STUDENT-NAME.
    DISPLAY STUDENT-NUMBER.
    DISPLAY WS-SPACE.

    DISPLAY WS-SEMESTER.
    DISPLAY WS-LABELS.

SET-WS-RECORD.
    MOVE COURSE TO WS-COURSE.
    MOVE COURSE-TITLE TO WS-COURSE-TITLE.
    MOVE GRADE TO WS-GRADE.
    MOVE CREDIT TO WS-CREDIT.

    PERFORM SET-QPTS.

SET-QPTS.
    MOVE WS-CREDIT TO WSC-QPTS.

    IF WS-GRADE IS EQUAL TO "A" THEN
        COMPUTE WSC-QPTS = WSC-QPTS * 4
    ELSE IF WS-GRADE IS EQUAL TO "B" THEN
        COMPUTE WSC-QPTS = WSC-QPTS * 3
    ELSE IF WS-GRADE IS EQUAL TO "C" THEN
        COMPUTE WSC-QPTS = WSC-QPTS * 2
    ELSE IF WS-GRADE IS EQUAL TO "D" THEN
        COMPUTE WSC-QPTS = WSC-QPTS * 1
    ELSE        
        MOVE 0 TO WSC-QPTS
    END-IF.

    MOVE WSC-QPTS TO WS-QPTS.

UPDATE-SEMESTER-TOTALS.
*> FOR EACH RECORD IN SEMESTER KEEP TRACK OF NUMBER OF EARNED CREDITS
    MOVE WS-CREDIT TO WSC-CREDIT.
    COMPUTE WSC-SEMESTER-CREDIT = WSC-SEMESTER-CREDIT + WSC-CREDIT.

*> FOR EACH RECORD IN SEMESTER KEEP TRACK OF NUMBER EARNED QUALITY POINTS.
*> WSC-QPTS IS CALCULATED IN SET-WS-RECORD SUBROUTINE.
    COMPUTE WSC-SEMESTER-QPTS = WSC-SEMESTER-QPTS + WSC-QPTS.

CALCULATE-EOS-TOTALS.
*> COMPUTE SEMESTER GPA AND PREP FOR DISPLAY AND WRITE.
    COMPUTE WSC-SEMESTER-GPA = WSC-SEMESTER-QPTS / WSC-SEMESTER-CREDIT.
    MOVE WSC-SEMESTER-GPA TO WS-SEMESTER-GPA.

*> MOVE VALUES STORED TO WS-SEMESTER EQUIVALENTS TO BE PROCESSED LATER WHEN
*> DISPLAYING AND WRITING TO THE FILE
    MOVE WSC-SEMESTER-CREDIT TO WS-SEMESTER-CREDIT.
    MOVE WSC-SEMESTER-QPTS TO WS-SEMESTER-QPTS.

*> COMPUTE THE CUMULATIVE VALUES AND PREP FOR DISPLAY AND WRITE
    COMPUTE WSC-CUMULATIVE-CREDIT = WSC-CUMULATIVE-CREDIT + WSC-SEMESTER-CREDIT.
    MOVE WSC-CUMULATIVE-CREDIT TO WS-CUMULATIVE-CREDIT.

    COMPUTE WSC-CUMULATIVE-QPTS = WSC-CUMULATIVE-QPTS + WSC-SEMESTER-QPTS.
    MOVE WSC-CUMULATIVE-QPTS TO WS-CUMULATIVE-QPTS.

*> COMPUTE CUMULATIVE GPA AND PREP FOR DISPLAY AND WRITE.
    COMPUTE WSC-CUMULATIVE-GPA = WSC-CUMULATIVE-QPTS / WSC-CUMULATIVE-CREDIT.
    MOVE WSC-CUMULATIVE-GPA TO WS-CUMULATIVE-GPA.

*> ZERO THE VALUES FOR START OF NEW SEMESTER
    MOVE ZERO TO WSC-SEMESTER-CREDIT.
    MOVE ZERO TO WSC-SEMESTER-QPTS.

DISPLAY-EOS-TOTALS.
    DISPLAY WS-EOS-SEMESTER-TOTALS.
    DISPLAY WS-EOS-CUM-TOTALS.

WRITE-EOS-TOTALS.
    WRITE OUT-EOS-SEMESTER-TOTALS FROM WS-EOS-SEMESTER-TOTALS.
    WRITE OUT-EOS-CUM-TOTALS FROM WS-EOS-CUM-TOTALS.

DISPLAY-SEMESTER-RECORDS.
    DISPLAY WS-RECORD.

WRITE-SEMESTER-RECORDS.
    WRITE OUT-RECORD FROM WS-RECORD.
